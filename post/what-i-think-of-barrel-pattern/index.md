---
title: "What Do I Think of the Barrel Pattern?"

abstract: "èµ·åˆï¼Œæˆ‘ä¸ºäº†ç¾åŒ–å¯¼å…¥è¯­å¥è€Œä½¿ç”¨ Barrel Patternï¼Œç›´åˆ°åæ¥ï¼Œæˆ‘æ‰æ„è¯†åˆ°å®ƒçœŸæ­£çš„é­…åŠ›â€”â€”æ–‡ä»¶çš„è®¿é—®æ§åˆ¶ã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿæœ‰ä¼—æ‰€å‘¨çŸ¥çš„é—®é¢˜ï¼Œäºæ˜¯æˆ‘å¼€å§‹æ„æƒ³ä¸€ç§æ–°çš„æ–¹æ¡ˆã€‚"

publishedDate: "2025-07-19T00:00:00+08:00"

updatedDate:  "2025-07-19T00:00:00+08:00"

tags: ["Module Pattern"]

hero: "hero.png"
---
Barrel Pattern æ˜¯ä¸€ç§æ–‡ä»¶çš„ç»„ç»‡æ¨¡å¼ï¼Œç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ index.ts æ¥é‡å¯¼å‡ºé‚£äº›ä½ å¸Œæœ›æš´éœ²ç»™å¤–ç•Œçš„æ¨¡å—ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```ts
// ğŸ“„ index.ts
export { a } from './a.ts';
export { b } from './b.ts';
```

å…¶ä¸­ï¼Œindex.ts å°±å«åš Barrel filesï¼Œå®ƒæ˜¾å¼çš„å®šä¹‰äº†ã€Œå“ªäº›æ¨¡å—ä¼šè¢«å¯¼å‡ºï¼Œå“ªäº›ä¸ä¼šã€ï¼Œè¿™å°±æ˜¯æ–‡ä»¶çš„è®¿é—®æ§åˆ¶ï¼Œæ–‡ä»¶çš„è®¿é—®æ§åˆ¶æ˜¯ä¸€é¡¹å®ç”¨çš„ç‰¹æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥æ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚

å¯æ˜¯ï¼ŒBarrel Pattern ä¹Ÿæœ‰ä¼—æ‰€å‘¨çŸ¥çš„é—®é¢˜ï¼š1ï¼‰é™ä½å¼€å‘æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæ¯”å¦‚æ‹–æ…¢å†·å¯åŠ¨å’Œçƒ­æ›´æ–°ï¼›2ï¼‰è¯±å‘å¾ªç¯å¼•ç”¨ã€‚è€Œå®è¯šåœ°è¯´ï¼Œè¿™æ˜¯æ„å»ºå·¥å…·çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯ Barrel Pattern çš„ã€‚

äºæ˜¯ï¼Œæˆ‘å¼€å§‹æ„æƒ³ä¸€ç§æ–°çš„æ–¹æ¡ˆï¼Œå®ƒæ—¢èƒ½æä¾›æ–‡ä»¶è®¿é—®æ§åˆ¶ï¼Œåˆèƒ½å…å» Barrel Pattern çš„é—®é¢˜ã€‚

## The good parts

Barrel Pattern æ‰€æä¾›çš„æ–‡ä»¶è®¿é—®æ§åˆ¶æ˜¯å®ƒæœ€å¸å¼•æˆ‘çš„åœ°æ–¹ï¼Œæ–‡ä»¶è®¿é—®æ§åˆ¶æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ¯”å¦‚ï¼š

å°† `Login` æ¨¡å—æ‹†åˆ†æˆå¤šä¸ªå­æ¨¡å—ï¼Œç„¶åå°†å¤§å®¶å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹å†…ï¼Œæœ€åå†é€šè¿‡ index.ts æ¥å¯¼å‡º component.tsï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```
|- src
   |- app.ts
   |- login
      |- index.ts
      |- hooks.ts
      |- helper.ts
      |- service.ts
      |- component.ts
```

```ts
// ğŸ“„ src/login/index.ts
export { Login } from './component.ts';
```

component.ts æ˜¯å¤–ç•Œå”¯ä¸€éœ€è¦å…³å¿ƒçš„æ¨¡å—ï¼Œå®ƒåº”å¯¹å¤–éƒ¨å¯è§ã€‚å…¶ä»–çš„ hooks.tsã€helper.tsã€service.ts éƒ½æ˜¯ä¸“ä¸º component.ts æœåŠ¡çš„ç§æœ‰æ¨¡å—ï¼Œå®ƒä»¬åº”å¯¹å¤–éƒ¨éšè—ï¼Œåªå¯¹ component.ts å¯è§ã€‚

å¦‚æ­¤ä¸€æ¥ï¼Œè°ƒç”¨è€…å°±å¯ä»¥æ˜ç¡®çš„çŸ¥é“ï¼Œä»–éœ€è¦å…³å¿ƒä»€ä¹ˆï¼ˆcomponent.tsï¼‰å’Œä¸éœ€è¦å…³å¿ƒä»€ä¹ˆï¼ˆhooks.tsã€helper.tsã€service.tsï¼‰ï¼Œè€Œä¸”ï¼Œå¯¹äºç»´æŠ¤è€…è€Œè¨€ï¼Œåªè¦ä¿è¯å…¬å…±æ¥å£ï¼ˆcomponent.tsï¼‰ä¸å˜ï¼Œé‚£ä¹ˆä»»ä½•ä»£ç çš„å˜æ›´å°±éƒ½æ˜¯å®‰å…¨çš„ï¼Œå“ªæ€•æ˜¯å¤§åˆ€é˜”æ–§çš„é‡æ„ã€‚

è¿™çœŸçš„å¾ˆæ£’ã€‚

åœ¨ç½‘ç»œä¸Šï¼Œå¤§å®¶è¿˜è®¨è®ºäº† Barrel Pattern çš„å¦ä¸€ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯å¯ä»¥ç¾åŒ–å¯¼å…¥è¯­å¥ï¼Œå› ä¸ºå®ƒå¯ä»¥ç®€åŒ–å¯¼å…¥è¯­å¥ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```ts
// Before
import { a } from '@/barrel/a.ts';
import { b } from '@/barrel/b.ts';

// After
import { a, b } from '@/barrel';
```

## The bad parts

> æ³¨ï¼šæœ¬æ–‡æåˆ°çš„æ„å»ºå·¥å…·æ˜¯æŒ‡ Vite@7.0 å’Œ next@15.4ã€‚

1ï¼‰è¯±å‘å¾ªç¯å¼•ç”¨ã€‚

å¾ªç¯å¼•ç”¨å¯èƒ½ä¼šå¯¼è‡´çƒ­æ›´æ–°å¤±çµï¼Œä¸€æ—¦å¤±çµï¼Œæ¯æ¬¡æ›´æ–°ä»£ç ï¼Œå¼€å‘æœåŠ¡å™¨éƒ½ä¼šé‡è½½æ•´ä¸ªç½‘é¡µã€‚å¦å¤–ï¼Œæ„å»ºå·¥å…·ä¹Ÿä¼šåœ¨æ‰“åŒ…æ—¶å‘å‡ºä¸€äº›æ¼äººçš„è­¦å‘Šã€‚

ç„¶åï¼Œäº‹æƒ…ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ï¼Œæ„å»ºå·¥å…·å¯ä»¥å¤„ç†ä¸€äº›ç®€å•çš„å¾ªç¯å¼•ç”¨ï¼Œæ¯”å¦‚ 2 ä¸ªæ–‡ä»¶ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ï¼Œä½†æ˜¯å¦‚æœå¯ä»¥ï¼Œåº”å°½å¯èƒ½çš„æœç»å¾ªç¯å¼•ç”¨ã€‚

2ï¼‰é™ä½å¼€å‘æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæ¯”å¦‚è®©å†·å¯åŠ¨å’Œçƒ­æ›´æ–°å˜æ…¢ã€‚

è¿™æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ

å¼€å‘æœåŠ¡å™¨æ˜¯ä¸åš Tree Shaking çš„ï¼Œæ‰€ä»¥å®ƒä¼šåŠ è½½å¯¼å…¥è·¯å¾„ä¸Šçš„æ‰€æœ‰èµ„æºï¼Œæ¯”å¦‚è™½ç„¶ app.ts åªå¯¼å…¥äº† a.tsï¼Œä½†æ˜¯å¼€å‘æœåŠ¡å™¨ä¹Ÿä¼šå…¨é‡åŠ è½½ b.ts å’Œ `lucide-react`ï¼Œå› ä¸ºå®ƒä»¬éƒ½åœ¨å¯¼å…¥è·¯å¾„ä¸Šï¼Œè€Œ `lucide-react` æœ‰ 1800+ ä¸ªå›¾æ ‡ã€‚

> åº“çš„å…¥å£æ–‡ä»¶éƒ½æ˜¯ Barrel filesï¼Œæ­£å¦‚ä¸‹è¿°ä»£ç æ‰€ç¤ºã€‚

```ts
// ğŸ“„ src/app.ts
import { a } from 'src/barrel';

// ğŸ“„ src/barrel/index.ts
export { a } from './a.ts';
export { b } from './b.ts';

// ğŸ“„ src/barrel/b.ts
import { Smile } from 'lucide-react';

// ğŸ“„ node_modules/lucide-react/dist/esm/icons/index.js
export { default as Smile } from './smile.js';
export { default as Reply } from './reply.js';
export { default as Shrub } from './shrub.js';
export { default as Stamp } from './stamp.js';
```

è¿™æ„å‘³ç€ Barrel Pattern ä¼šè¯±ä½¿å¼€å‘æœåŠ¡å™¨åŠ è½½æ›´å¤šçš„èµ„æºï¼Œè€ŒåŠ è½½çš„èµ„æºè¶Šå¤šï¼Œå¼€å‘æœåŠ¡å™¨å°±ä¼šè¶Šæ…¢ã€‚

å¦‚æœä½ åœ¨ä½¿ç”¨ Next.jsï¼Œé‚£ä¹ˆäº‹æƒ…ä¼šæ›´ä¹è§‚ä¸€äº›ï¼Œå› ä¸º Next.js çš„æ„å»ºå·¥å…·å¯¹æ­¤åšäº†é’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚å®ƒä¼šåˆ†æç¬¬ä¸‰æ–¹åº“ï¼Œç„¶åè®¡ç®—å‡ºç›®æ ‡èµ„æºçš„ç²¾ç¡®è·¯å¾„ï¼Œä»¥ç»•è¿‡å…¥å£æ–‡ä»¶ï¼Œä»è€Œé¿å…å…¨é‡åŠ è½½ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```ts
// Before
import { Smile } from 'lucide-react';

// After
import Smile from 'lucide-react/dist/esm/icons/smile.js';
```

ç»†èŠ‚è¯·è§ [optimizePackageImports](https://nextjs.org/docs/app/api-reference/config/next-config-js/optimizePackageImports)ï¼ŒåŸç†è¯·è§ [How we optimized package imports in Next.js](https://vercel.com/blog/how-we-optimized-package-imports-in-next-js#new-solution:-optimizepackageimports)ã€‚

## The trade off

æˆ‘æ¨å´‡ Barrel Pattern æ‰€æä¾›çš„æ–‡ä»¶è®¿é—®æ§åˆ¶ï¼Œä¹Ÿæ„¿æ„ä¸ºæ­¤è®©æ¸¡ä¸€äº›å¼€å‘ä½“éªŒï¼Œè€Œäº‹æƒ…çš„å…³é”®åœ¨äºã€Œéœ€è¦è®©æ¸¡å¤šå°‘ã€ã€‚

æœ€ç³Ÿçš„æƒ…å†µå°±æ˜¯ Barrel Pattern å°†æ‰€æœ‰èµ„æºéƒ½ä¸²è”åœ¨äº†ä¸€èµ·ï¼Œå†·å¯åŠ¨å’Œæ¯æ¬¡çƒ­æ›´æ–°éƒ½è¦å…¨é‡åŠ è½½æ‰€æœ‰èµ„æºï¼Œè¿™å¯¹å¤§å‹é¡¹ç›®æ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ï¼Œå› ä¸ºè¿™ç»å¯¹ä¼šè¶…çº§æ…¢ï¼Œä½†å¯¹äºå°å‹é¡¹ç›®è€Œè¨€ï¼Œåˆ™æ— æ‰€è°“ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä¼šåœ¨å°å‹é¡¹ç›®ä¸Šä½¿ç”¨ Barrel Patternï¼Œå…¶ä½™æƒ…å†µä¸‹ï¼Œåˆ™ä¸ä¼šã€‚

## Superior alternative

æˆ‘æ„æƒ³äº†ä¸€ç§æ–°çš„æ–¹æ¡ˆï¼Œå«åš Underscore Patternã€‚

å®ƒæ˜¯ Barrel Pattern çš„ä¸Šä½æ›¿ä»£ï¼Œæ—¢æä¾›æ–‡ä»¶è®¿é—®æ§åˆ¶ï¼Œåˆå…‹æœäº†åè€…çš„é—®é¢˜ï¼Œå®ƒçš„ä½¿ç”¨è§„åˆ™åªæœ‰ä¸€æ¡ï¼šä¸‹åˆ’çº¿å¼€å¤´çš„æ–‡ä»¶åªå¯¹åŒç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶å¯è§ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ`_helpers.ts` çš„å¯è§èŒƒå›´æ˜¯æš—è“è‰²åŒºåŸŸï¼ˆå³è¯¥åŒºåŸŸå†…çš„æ–‡ä»¶éƒ½å¯ä»¥è®¿é—®å®ƒï¼‰ï¼Œ`_input.ts | _button.ts` çš„å¯è§èŒƒå›´æ˜¯äº®è“è‰²åŒºåŸŸï¼ˆå³è¯¥åŒºåŸŸå†…çš„æ–‡ä»¶éƒ½å¯ä»¥è®¿é—®å®ƒä»¬ï¼‰ã€‚

![Underscore Pattern rules](./img/underscore-pattern-rule.png)

å› ä¸º Underscore Pattern ä½¿ç”¨æ–‡ä»¶åæ¥æ§åˆ¶è®¿é—®æƒé™ï¼Œè€Œä¸æ˜¯ index.tsï¼Œæ‰€ä»¥å®ƒå…‹æœäº† Barrel Pattern çš„é—®é¢˜ã€‚

æœ€åï¼Œä¸ºäº†è¾…åŠ©ä½¿ç”¨ Underscore Patternï¼Œæˆ‘åˆ¶ä½œäº† [`@jynxio/eslint-plugin`](https://github.com/jynxio/eslint-plugin) è¿™ä¸ª ESLint æ’ä»¶ï¼Œå¦‚æœå¯¼å…¥è¯­å¥çš„èµ„æºè·¯å¾„ä¸åˆæ³•ï¼Œé‚£ä¹ˆå°±ä¼šé£˜çº¢ã€‚

å¦‚æœæ²¡æœ‰è¿™ä¸ªæ’ä»¶ï¼Œé‚£ä¹ˆ Underscore Pattern å°±è¦ä¾èµ–çº¦å®šæ¥è¿ä½œï¼Œè€Œçº¦å®šæ˜¯è„†å¼±çš„ï¼Œå°¤å…¶æ˜¯åœ¨å›¢é˜Ÿåˆä½œæ—¶ï¼Œè€Œä¸”è®¡ç®—èµ„æºè·¯å¾„çš„åˆæ³•ä¸å¦å¾ˆçƒ§è„‘ã€‚

æˆ‘ç°åœ¨æ€»æ˜¯ä½¿ç”¨å®ƒä»¬ï¼Œæ¯”å¦‚è¿™ä¸ªç«™ç‚¹ï¼Œå®ƒä»¬å·¥ä½œçš„å¾ˆæ£’ã€‚
